(function(global,factory){'object'==typeof exports&&'undefined'!=typeof module?module.exports=factory():'function'==typeof define&&define.amd?define('faux',factory):global.faux=factory()})(this,function(){'use strict';function assertString(str){if('string'!=typeof str)throw new Error('Some argument is not a string')}function normalize(path){if(!path)return'.';assertString(path);const significant=[];let isAbsolute=!1;0===path.indexOf('/')&&(isAbsolute=!0);const pathArray=path.match(/[^/]+/g);for(let i in pathArray){const name=pathArray[i],lastItem=significant[significant.length-1];'.'===name||('..'===name?isAbsolute?significant.pop():0===significant.length||'..'===lastItem?significant.push('..'):significant.pop():significant.push(name))}return isAbsolute?'/'+significant.join('/'):significant.join('/')}function chop(path){const segments=normalize(path).match(/[^/]+/g);return segments?segments:[]}function getMode(mode='r'){return{r:{read:!0,write:!1,truncate:!1,create:!1,append:!1},"r+":{read:!0,write:!0,truncate:!1,create:!1,append:!1},w:{read:!1,write:!0,truncate:!0,create:!0,append:!1},"w+":{read:!0,write:!0,truncate:!0,create:!0,append:!1},a:{read:!1,write:!0,truncate:!1,create:!0,append:!0},"a+":{read:!0,write:!0,truncate:!1,create:!0,append:!0}}[mode]}function resolvePath(inputPath,process){return'/'===inputPath[0]?inputPath:process.cwd+'/'+inputPath}function fail(process,id,reason){process.worker.postMessage({status:'error',reason,id})}function pass(process,id,result){process.worker.postMessage({status:'success',result,id})}function mkWorker(scriptStr){const blob=new Blob([scriptStr],{type:'application/javascript'}),uri=URL.createObjectURL(blob);return new Worker(uri)}class Inode{constructor(config={}){this.links=1,this.executable=!1,Object.assign(this,config)}read(){return this.file?this.contents:-1}write(contents){return this.file?void(this.contents=contents):-1}append(contents){return this.file?void(this.contents+=contents):-1}truncate(){return this.file?void(this.contents=''):-1}readdir(){return this.dir?Object.keys(this.children):-1}}class OFS{constructor(inodes){this.inodes=inodes||[new Inode({dir:!0,children:{}})]}resolve(pathArray){const rootInode=this.inodes[0],inodeArray=[rootInode];for(let i in pathArray){const prevInode=inodeArray.slice(-1)[0];if(!prevInode.children)return-1;const name=pathArray[i],nextInode=prevInode.children[name];if(!nextInode)return-2;inodeArray.push(nextInode)}return inodeArray.pop()}addInode(parent,name,config){if(name.match('/'))return-1;const inode=new Inode(config);if(parent.dir)this.inodes.push(inode),parent.children[name]=inode;else return-1;return inode}create(pathArray){const parent=this.resolve(pathArray.slice(0,-1)),name=pathArray.slice(-1)[0],inode=this.addInode(parent,name,{file:!0,contents:''});return 0>inode?-1:inode}mkdir(pathArray){const parent=this.resolve(pathArray.slice(0,-1)),name=pathArray.slice(-1)[0],inode=this.addInode(parent,name,{dir:!0,children:{}});return 0>inode?-1:inode}link(oldPathArray,newPathArray){const oldInode=this.resolve(oldPathArray),newParent=this.resolve(newPathArray.slice(0,-1)),newName=newPathArray.slice(-1)[0];return newName.match('/')?-1:newParent.dir?void(newParent.children[newName]=oldInode):-1}unlink(pathArray){const parent=this.resolve(pathArray.slice(0,-1)),name=pathArray.slice(-1)[0];return 0>parent?-1:parent.dir?void delete parent.children[name]:-1}}class Inode$1{constructor(config={}){this.links=1,this.executable=!1,this.dir=!0,this.file=!0,Object.assign(this,config)}get contents(){return this.raw.innerHTML}set contents(contents){return this.raw.innerHTML=contents}get children(){const dir=[],children=this.raw.children;for(let i=0;i<children.length;i++){const child=children[i],name=child.localName,id=child.id?'#'+child.id:'',classes=child.className?'.'+child.className.replace(/\s+/g,'.'):'';dir.push(name+id+classes),dir.push(i+1)}return dir}read(){return this.contents}write(contents){this.contents=contents}append(contents){this.contents+=contents}truncate(){this.contents=''}readdir(){return Object.keys(this.children)}}var console$1=new class{constructor(config={}){this.lineBuffer=[],this.input='',this.config={buffer:!0,echo:!0},Object.assign(this.config,config)}read(){const ret=this.input;return this.input='',ret}write(contents){console.log('Unhandled console write: '+contents)}send(key){this.config.buffer?this.handle(key):this.input+=key,this.config.echo&&this.write(key)}handle(key){'\x7F'===key?this.backSpace():'\r'===key?this.enter():this.lineBuffer.push(key)}backSpace(){this.lineBuffer.pop(),this.write('\b \b')}enter(){this.lineBuffer.push('\n');const line=this.lineBuffer.join('');this.input+=line,this.lineBuffer=[],this.write('\r\n')}};const rootFs=new OFS,bin=rootFs.mkdir(['bin']);rootFs.addInode(bin,'fsh',{file:!0,executable:!0,contents:'(function(){"use strict";function tokenizeLine(line=""){const tokens=line.match(/(["\'])(?:\\\\|.)+\\1|((?:[^\\\\\\s]|\\\\.)*)/g).filter(String);for(let token,i=0;i<tokens.length;i++)token=tokens[i],tokens[i]=token.replace(/\\\\(?=.)/g,""),token.match(/^["\'].+(\\1)$/m)&&(tokens[i]=/^(["\'])(.+)(\\1)$/gm.exec(token)[2]);return tokens}function lex(input=""){const allTokens=[],lines=input.match(/(\\\\;|[^;])+/g);for(let tokens,i=0;i<lines.length;i++)tokens=tokenizeLine(lines[i]),allTokens.push(tokens);return allTokens}function parseCommand(tokens){const command={type:"simple",argv:tokens,argc:tokens.length,name:tokens[0]};return command}(function(input=""){const AST={type:"script",commands:[]},commands=lex(input);for(let parsed,i=0;i<commands.length;i++)parsed=parseCommand(commands[i]),AST.commands[i]=parsed;return AST})("echo hello, world")})();'});const dev=rootFs.mkdir(['dev']);rootFs.mkdir(['dev','dom']),rootFs.addInode(dev,'console',{device:!0}),rootFs.mkdir(['home']),rootFs.mkdir(['log']),rootFs.mkdir(['tmp']);const fs=new class{constructor(rootDrive=new OFS){this.mounts={"/":rootDrive}}mount(fs,mountPoint){const normalized=normalize(mountPoint),inode=this.resolve(normalized);return inode&&inode.dir?(this.mounts[normalized]=fs,normalized):-1}unmount(mountPoint){const normalized=normalize(mountPoint);return this.mounts[normalized]=null}getMountPoint(path){const pathArray=chop(path);if(1===pathArray.length&&'/'===pathArray[0])return pathArray;const segments=[];for(let matchPath,i=0;i<=pathArray.length;i++)matchPath=pathArray.slice(0,i),segments.push('/'+matchPath.join('/'));const resolves=[];return Object.keys(this.mounts).forEach(mount=>{for(let i in segments)segments[i]===mount&&resolves.push(mount)}),resolves.pop()}getPathInfo(path){const normalized=normalize(path),mountPoint=this.getMountPoint(normalized),localFsPath=normalized.substring(mountPoint.length)||'/';return{localFs:this.mounts[mountPoint],localFsPathArray:chop(localFsPath)}}resolve(path){const{localFs,localFsPathArray}=this.getPathInfo(path),inode=localFs.resolve(localFsPathArray);return 0>inode?-1:inode}create(path){const{localFs,localFsPathArray}=this.getPathInfo(path),inode=localFs.create(localFsPathArray);return 0>inode?-1:inode}mkdir(path){const{localFs,localFsPathArray}=this.getPathInfo(path),inode=localFs.mkdir(localFsPathArray);return 0>inode?-1:inode}link(){}unlink(path){const{localFs,localFsPathArray}=this.getPathInfo(path),ret=localFs.unlink(localFsPathArray);return 0>ret?-1:ret}}(rootFs);fs.mount(new class{constructor(){this.mkdir=this.create}resolve(pathArray){let element;if(0===pathArray.length)element=document.querySelector('*');else{let selector=' '+pathArray.join(' > ');selector=selector.replace(/ (\d)/g,' :nth-child($1)'),element=document.querySelector(selector)}return new Inode$1({raw:element})}create(pathArray){const parent=this.resolve(pathArray.slice(0,-1));if(!parent)return-1;const name=pathArray.slice(-1)[0],element=document.createElement(name);return parent.appendChild(element),new Inode$1({raw:element})}link(){}unlink(){}},'/dev/dom');class FileDescriptor{constructor(path,mode){if(this.mode=getMode(mode),this.path=normalize(path),this.inode=fs.resolve(this.path),0>this.inode){if(!this.mode.create)return-1;if(fs.create(this.path),this.inode=fs.resolve(this.path),!this.inode)return-2}this.mode.truncate&&this.inode.truncate()}read(){return this.mode.read?this.inode.read():-1}write(contents){return this.mode.write?this.mode.append?this.inode.append(contents):this.inode.write(contents):-1}readdir(){return this.inode.readdir()}}var sys=Object.freeze({spawn:function(process,msgID,args){const[image,argv]=args;if('string'!=typeof image)return fail(process,msgID,'First argument - image - should be a string');if(!argv instanceof Array)return fail(process,msgID,'Second argument - argv - should be an array');const newProcess=new Process(image,argv),pid=processTable.add(newProcess);return pass(process,msgID,pid)},exec:function(process,msgID,args){const[inputPath,argv]=args;if('string'!=typeof inputPath)return fail(process,msgID,'First argument - path - should be a string');if(!argv instanceof Array)return fail(process,msgID,'Second argument - argv - should be an array');const safePath=resolvePath(inputPath,process),image=fs.resolve(safePath).data,newProcess=new Process(image,argv),pid=processTable.add(newProcess);return pass(process,msgID,pid)},exists:function(process,msgID,args){const[inputPath]=args;if('string'!=typeof inputPath)return fail(process,msgID,'First argument - path - should be a string');const safePath=resolvePath(inputPath,process),result=process.exists(safePath);return pass(process,msgID,result)},stat:function(process,msgID,args){const[inputPath]=args;if('string'!=typeof inputPath)return fail(process,msgID,'First argument - path - should be a string');const safePath=resolvePath(inputPath,process),inode=fs.resolve(safePath);return pass(process,msgID,{file:!!inode.file,dir:!!inode.dir,device:!!inode.device,executable:!!inode.executable,links:inode.links})},open:function(process,msgID,args){const[inputPath,mode]=args;if('string'!=typeof inputPath)return fail(process,msgID,'First argument - path - should be a string');if('string'!=typeof mode)return fail(process,msgID,'Second argument - mode - should be a string');const safePath=resolvePath(inputPath,process),fd=process.open(safePath,mode);return 0>fd?fail('Could not open file'):pass(process,msgID,fd)},close:function(process,msgID,args){const[fd]=args;if(0>fd)return fail(process,msgID,'File Descriptor should be >= 0');if(!process.fds[fd])return fail(process,msgID,'File Descriptor must exist');const result=process.close(fd);return pass(process,msgID,result)},dup:function(process,msgID,args){const[fd]=args;if(0>fd)return fail(process,msgID,'File Descriptor should be >= 0');if(!process.fds[fd])return fail(process,msgID,'File Descriptor must exist');const newFd=process.dup(fd);return pass(process,msgID,newFd)},dup2:function(process,msgID,args){const[fd1,fd2]=args;if(0>fd1)return fail(process,msgID,'File Descriptor 1 should be >= 0');if(!process.fds[fd1])return fail(process,msgID,'File Descriptor 1 must exist');if(0>fd2)return fail(process,msgID,'File Descriptor 2 should be >= 0');const newFd=process.dup2(fd1,fd2);return pass(process,msgID,newFd)},read:function(process,msgID,args){const[fd]=args;if(0>fd)return fail(process,msgID,'File Descriptor should be >= 0');const data=process.fds[fd].read();if(-2===data)return fail('No data returned, possibly not a file');return 0>data?fail('Could not get data'):pass(process,msgID,data)},readdir:function(process,msgID,args){const[fd]=args;if(0>fd)return fail(process,msgID,'File Descriptor should be >= 0');const children=process.fds[fd].readdir();return 0>children?fail('No children returned, possibly not a directory'):pass(process,msgID,children)},write:function(process,msgID,args){const[fd,data]=args;if(0>fd)return fail(process,msgID,'File Descriptor should be >= 0');if('string'!=typeof data)return fail(process,msgID,'Second argument - data - should be a string');const result=process.fds[fd].write(data);return 0>result?fail('Could not write data'):pass(process,msgID,result)},mkdir:function(process,msgID,args){const[inputPath]=args;if('string'!=typeof inputPath)return fail(process,msgID,'First argument - path - should be a string');const safePath=resolvePath(inputPath,process),result=fs.mkdir(safePath);return 0>result?fail('Could not create directory'):pass(process,msgID,safePath)},unlink:function(process,msgID,args){const[inputPath]=args;if('string'!=typeof inputPath)return fail(process,msgID,'First argument - path - should be a string');const safePath=resolvePath(inputPath,process),result=fs.unlink(safePath);return 0>result?fail('Could not create directory'):pass(process,msgID,result)},pwd:function(process,msgID){return pass(process,msgID,process.cwd)},chdir:function(process,msgID,args){const[inputPath]=args;if('string'!=typeof inputPath)return fail(process,msgID,'First argument - path - should be a string');const safePath=resolvePath(inputPath,process),result=process.cwd=safePath;return pass(process,msgID,result)},getenv:function(process,msgID,args){const[key]=args;if(key){if('string'!=typeof key)return fail(process,msgID,'First argument - key - should be a string (or a falsey value)');const value=process.env[key];return pass(process,msgID,value)}return pass(process,msgID,process.env)},setenv:function(process,msgID,args){const[key,value]=args;if('string'!=typeof key)return fail(process,msgID,'First argument - key - should be a string');if('string'!=typeof value)return fail(process,msgID,'Second argument - value - should be a string');const result=process.env[key]=value;return pass(process,msgID,result)}}),utils=Object.freeze({genUUID:function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(char){let r=0|16*Math.random(),v='x'===char?r:8|3&r;return v.toString(16)})},mkWorker:mkWorker,openLocalFile:function(readAs='readAsText'){const input=document.createElement('input');return input.type='file',input.click(),new Promise(function(resolve){input.onchange=function(){const file=input.files[0],reader=new FileReader;reader[readAs](file),reader.onloadend=function(){resolve(reader.result)}}})},http:function(uri,method='GET'){return new Promise((resolve,reject)=>{!uri instanceof String&&reject('URI invalid');const xhr=new XMLHttpRequest;xhr.open(method,uri,!0),xhr.onload=function(){300>xhr.status&&200<=xhr.status?resolve(xhr.response):reject(xhr.status+' '+xhr.statusText)},xhr.onerror=function(err){reject(err)},xhr.send()})}});class Process{constructor(image='',argv=[]){this.image=image,this.argv=argv,this.argc=this.argv.length,this.fds=[],this.cwd='/',this.env={SHELL:'fsh',PATH:'./:/bin',HOME:'/home',TERM:'xterm-256color'};const jsonArgv=JSON.stringify(this.argv),expose=`const argv = ${jsonArgv}; const argc = ${this.argc};`;this.worker=mkWorker([expose,'var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};(function(){"use strict";function newID(length=10){const chars="0123456789abcdefghiklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXTZ".split("");let id="";for(let i=0;i<length;i++){const randomIndex=Math.floor(Math.random()*chars.length);id+=chars[randomIndex]}return id}function call(name="",args=[]){const id=newID();return postMessage({type:"syscall",name,args,id}),new Promise((resolve,reject)=>{function listener(message){const msg=message.data;msg.id===id&&("success"===msg.status?resolve(msg.result):reject(msg.reason),removeEventListener("message",listener))}addEventListener("message",listener)})}function assertString(str){if("string"!=typeof str)throw new Error("Some argument is not a string")}function normalize(path){if(!path)return".";assertString(path);const significant=[];let isAbsolute=!1;0===path.indexOf("/")&&(isAbsolute=!0);const pathArray=path.match(/[^/]+/g);for(let i in pathArray){const name=pathArray[i],lastItem=significant[significant.length-1];"."===name||(".."===name?isAbsolute?significant.pop():0===significant.length||".."===lastItem?significant.push(".."):significant.pop():significant.push(name))}return isAbsolute?"/"+significant.join("/"):significant.join("/")}function parse(path=""){assertString(path);const normalized=normalize(path),matches=normalized.match(splitPathRe);return{root:matches[1],dir:matches[2],base:matches[3],ext:matches[4],name:matches[3].slice(0,matches[3].length-matches[4].length)}}function loadFile(path){return __awaiter(this,void 0,void 0,function*(){const pathStat=yield sys.stat(path);if(pathStat.file)return self.eval((yield fs.readFile(path)));const pathJsStat=yield sys.stat(path+".js");if(pathJsStat.file)return self.eval((yield fs.readFile(path+".js")));const pathJsonStat=yield sys.stat(path+".json");if(pathJsonStat.file)return JSON.parse((yield fs.readFile(path+".json")));throw new Error("not found")})}function wrap(style,str){return"\\x1B["+ansi[style][0]+"m"+str+"\\x1B["+ansi[style][1]+"m"}function dye(styles,str){if(styles instanceof Array)for(let i in styles)str=wrap(styles[i],str);else"string"==typeof styles&&(str=wrap(styles,str));return str}var sys$1=Object.freeze({spawn:function(image="",argv=[]){return __awaiter(this,void 0,void 0,function*(){return call("spawn",[image,argv])})},exec:function(path,argv=[]){return __awaiter(this,void 0,void 0,function*(){return call("exec",[path,argv])})},exists:function(path){return __awaiter(this,void 0,void 0,function*(){return call("exists",[path])})},stat:function(path){return __awaiter(this,void 0,void 0,function*(){return call("stat",[path])})},open:function(path,mode="r"){return __awaiter(this,void 0,void 0,function*(){return call("open",[path,mode])})},close:function(fd){return __awaiter(this,void 0,void 0,function*(){return call("close",[fd])})},dup:function(fd){return __awaiter(this,void 0,void 0,function*(){return call("dup",[fd])})},dup2:function(fd1,fd2){return __awaiter(this,void 0,void 0,function*(){return call("dup2",[fd1,fd2])})},read:function(fd){return __awaiter(this,void 0,void 0,function*(){return call("read",[fd])})},readdir:function(fd){return __awaiter(this,void 0,void 0,function*(){return call("readdir",[fd])})},write:function(fd,data=""){return __awaiter(this,void 0,void 0,function*(){return call("write",[fd,data])})},mkdir:function(path){return __awaiter(this,void 0,void 0,function*(){return call("mkdir",[path])})},unlink:function(path){return __awaiter(this,void 0,void 0,function*(){return call("unlink",[path])})},pwd:function(){return __awaiter(this,void 0,void 0,function*(){return call("pwd",[])})},chdir:function(path="/home"){return __awaiter(this,void 0,void 0,function*(){return call("chdir",[path])})},getenv:function(key){return __awaiter(this,void 0,void 0,function*(){return call("getenv",[key])})},setenv:function(key,value=""){return __awaiter(this,void 0,void 0,function*(){return call("setenv",[key,value])})}}),browser=function(){const ua=navigator.userAgent,matches=ua.match(/(vivaldi|opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*([\\d.]+)/i)||[];if(/trident/i.test(matches[1])){const tem=ua.match(/\\brv[ :]+([\\d.]+)/g)||"";return["IE",tem[1]]}if("Chrome"===matches[1]){const tem=ua.match(/\\b(OPR|Edge)\\/([\\d.]+)/);if(tem)return["Opera",tem[1]]}return matches[2]?{name:matches[1],version:matches[2]}:{name:navigator.appName,version:navigator.appVersion}}();const splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;var path=Object.freeze({normalize:normalize,parse:parse,dirname:function(path=""){const parsed=parse(path);return parsed.root?"/"+parsed.dir:parsed.dir},basename:function(path="",extension=""){const basename=parse(path).base,indexOf=basename.indexOf(extension);return indexOf&&indexOf+extension.length===basename.length?basename.slice(0,indexOf):basename},extname:function(path){return parse(path).ext},join:function(){const paths=[];for(let i in arguments)assertString(arguments[i]),paths.push(arguments[i]);const joined=paths.join("/");return normalize(joined)},chop:function(path){const segments=normalize(path).match(/[^/]+/g);return segments?segments:[]}}),fs$1=Object.freeze({readFile:function(path){return __awaiter(this,void 0,void 0,function*(){const fd=yield sys.open(path,"r"),data=sys.read(fd);return sys.close(fd),data})},writeFile:function(path,data=""){return __awaiter(this,void 0,void 0,function*(){const fd=yield sys.open(path,"w");return sys.write(fd,data),void sys.close(fd)})},appendFile:function(path,data=""){return __awaiter(this,void 0,void 0,function*(){const fd=yield sys.open(path,"a");return sys.write(fd,data),void sys.close(fd)})}});const stdout={write(str){console.log(str)}};var process$1=Object.freeze({stdin:{},stdout:stdout,stderr:{}});const esc="\\x1B[";const ansi={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]};var symbols={info:dye("blue","\\u2139"),success:dye("green","\\u2714"),warning:dye("yellow","\\u26A0"),error:dye("red","\\u2716"),star:dye("yellowBright","\\u2605"),radioOn:dye("green","\\u25C9"),radioOff:dye("red","\\u25EF"),checkboxOn:dye("green","\\u2612"),checkboxOff:dye("red","\\u2610"),arrowUp:"\\u2191",arrowDown:"\\u2193",arrowLeft:"\\u2190",arrowRight:"\\u2192",line:"\\u2500",play:"\\u25B6",pointer:"\\u276F",pointerSmall:"\\u203A",square:"\\u2587",squareSmall:"\\u25FC",bullet:"\\u25CF"};Object.assign(self,{sys:sys$1,browser,path,http:function(uri,method="GET"){return new Promise((resolve,reject)=>{!uri instanceof String&&reject("URI invalid");const xhr=new XMLHttpRequest;xhr.open(method,uri,!0),xhr.onload=function(){300>xhr.status&&200<=xhr.status?resolve(xhr.response):reject(xhr.status+" "+xhr.statusText)},xhr.onerror=function(err){reject(err)},xhr.send()})},fs:fs$1,process:process$1,require:function(requirePath=""){return __awaiter(this,void 0,void 0,function*(){if("string"!=typeof requirePath)throw new Error("argument is not a string");try{return yield loadFile(requirePath)}catch(err){return loadFile(requirePath+"/index")}})},cli:{ArgParser:class{constructor(options){this.options=options||{}}parse(argv=process.argv){}},control:{cursor:{move:{to:(x=1,y=1)=>esc+x+";"+y+"H",up:(n=1)=>esc+n+"A",down:(n=1)=>esc+n+"B",right:(n=1)=>esc+n+"C",left:(n=1)=>esc+n+"D",nextLine:()=>esc+"E",prevLine:()=>esc+"F",leftMost:()=>esc+"G"},hide:()=>esc+"?25l",show:()=>esc+"?25h",shape:{block:()=>"\\x1B]50;CursorShape=0\\x07",bar:()=>"\\x1B]50;CursorShape=1\\x07",underscore:()=>"\\x1B]50;CursorShape=2\\x07"},savePosition:()=>esc+"s",restorePosition:()=>esc+"u"},line:{eraseEnd:()=>esc+"K",eraseStart:()=>esc+"1K",erase:()=>esc+"2K"},screen:{eraseDown:()=>esc+"J",eraseUp:()=>esc+"1J",erase:()=>esc+"2J",clear:()=>"\\x1Bc",scrollUp:(n=1)=>esc+n+"S",scrollDown:(n=1)=>esc+n+"T"},beep:()=>"\\x07",setTitle:str=>"\\x1B]0;"+str+"\\x07"},dye,symbols,Spinner:class{constructor(name){const spinner={line:{fps:8,frames:["-","\\\\","|","/"]},dots:{fps:12.5,frames:["\\u280B","\\u2819","\\u2839","\\u2838","\\u283C","\\u2834","\\u2826","\\u2827","\\u2807","\\u280F"]},scrolling:{fps:5,frames:[".  ",".. ","..."," ..","  .","   "]},scrolling2:{fps:2.5,frames:[".  ",".. ","...","   "]},star:{fps:14,frames:["\\u2736","\\u2738","\\u2739","\\u273A","\\u2739","\\u2737"]},bounceyBall:{fps:8,frames:["\\u2801","\\u2802","\\u2804","\\u2802"]},triangle:{fps:15,frames:["\\u25E2","\\u25E3","\\u25E4","\\u25E5"]},circle:{fps:15,frames:["\\u25D0","\\u25D3","\\u25D1","\\u25D2"]},bounce:{fps:12.5,frames:["( \\u25CF    )","(  \\u25CF   )","(   \\u25CF  )","(    \\u25CF )","(     \\u25CF)","(    \\u25CF )","(   \\u25CF  )","(  \\u25CF   )","( \\u25CF    )","(\\u25CF     )"]},clock:{fps:10,frames:["\\uD83D\\uDD50 ","\\uD83D\\uDD51 ","\\uD83D\\uDD52 ","\\uD83D\\uDD53 ","\\uD83D\\uDD54 ","\\uD83D\\uDD55 ","\\uD83D\\uDD56 ","\\uD83D\\uDD57 ","\\uD83D\\uDD58 ","\\uD83D\\uDD59 ","\\uD83D\\uDD5A "]},pong:{fps:12.5,frames:["\\u2590\\u2802       \\u258C","\\u2590\\u2808       \\u258C","\\u2590 \\u2802      \\u258C","\\u2590 \\u2820      \\u258C","\\u2590  \\u2840     \\u258C","\\u2590  \\u2820     \\u258C","\\u2590   \\u2802    \\u258C","\\u2590   \\u2808    \\u258C","\\u2590    \\u2802   \\u258C","\\u2590    \\u2820   \\u258C","\\u2590     \\u2840  \\u258C","\\u2590     \\u2820  \\u258C","\\u2590      \\u2802 \\u258C","\\u2590      \\u2808 \\u258C","\\u2590       \\u2802\\u258C","\\u2590       \\u2820\\u258C","\\u2590       \\u2840\\u258C","\\u2590      \\u2820 \\u258C","\\u2590      \\u2802 \\u258C","\\u2590     \\u2808  \\u258C","\\u2590     \\u2802  \\u258C","\\u2590    \\u2820   \\u258C","\\u2590    \\u2840   \\u258C","\\u2590   \\u2820    \\u258C","\\u2590   \\u2802    \\u258C","\\u2590  \\u2808     \\u258C","\\u2590  \\u2802     \\u258C","\\u2590 \\u2820      \\u258C","\\u2590 \\u2840      \\u258C","\\u2590\\u2820       \\u258C"]}}[name];this.frames=spinner.frames,this.index=0,this.interval=Math.round(1e3/spinner.fps),this.setIntervalIndex=null}next(){this.index++;const realIndex=(this.index-1)%this.frames.length;return this.frames[realIndex]}start(outputFunction){outputFunction=outputFunction||(str=>process.stdout.write(str)),this.setIntervalIndex=setInterval(()=>{let frame=this.next(),clearFrame=frame.replace(/./g,"\\b");outputFunction(clearFrame),outputFunction(frame)},this.interval)}stop(){clearInterval(this.setIntervalIndex)}}}}),addEventListener("message",message=>{const msg=message.data;if("event"===msg.type&&msg.name&&msg.detail){const event=new CustomEvent(msg.name,{detail:msg.detail});dispatchEvent(event)}})})();',image].join('\n\n')),this.worker.addEventListener('message',message=>{this.messageHandler(message)})}messageHandler(message){const msg=message.data;if('syscall'===msg.type&&msg.name in sys)void 0!==msg.id&&msg.args instanceof Array&&sys[msg.name](this,msg.id,msg.args);else if('event'===msg.type&&msg.name&&msg.detail){const event=new CustomEvent(msg.name,{detail:msg.detail});dispatchEvent(event)}else{const error={status:'error',reason:'Invalid request - Rejected by the message handler',id:msg.id};this.worker.postMessage(error)}}exists(path){const vnode=fs.resolve(path);return!!vnode.container}open(path,mode='r'){try{const fd=new FileDescriptor(path,mode);return this.fds.push(fd),this.fds.length-1}catch(err){return-1}}close(fd){return this.fds[fd]?this.fds[fd]=null:-1}dup(fd){if(!this.fds[fd])return-1;const copied=this.fds[fd];return this.fds.push(copied),this.fds.length-1}dup2(fd1,fd2){return this.fds[fd1]?(this.fds[fd2]=this.fds[fd1],fd2):-1}}var processTable=new class{constructor(init=new Process){if(!init instanceof Process)throw new Error('Init process is invalid');this.list=[init]}add(process){return this.list.push(process)-1}emit(name,detail,pids=Object.keys(this.list)){for(let i in pids){const pid=pids[i];this.list[pid].worker.postMessage({type:'event',name,detail})}}},browser=function(){const ua=navigator.userAgent,matches=ua.match(/(vivaldi|opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d.]+)/i)||[];if(/trident/i.test(matches[1])){const tem=ua.match(/\brv[ :]+([\d.]+)/g)||'';return['IE',tem[1]]}if('Chrome'===matches[1]){const tem=ua.match(/\b(OPR|Edge)\/([\d.]+)/);if(tem)return['Opera',tem[1]]}return matches[2]?{name:matches[1],version:matches[2]}:{name:navigator.appName,version:navigator.appVersion}}();return{fs,sys,proc:processTable,utils,console:console$1,browser,version:'0.0.3'}});